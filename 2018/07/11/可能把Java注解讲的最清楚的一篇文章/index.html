<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 可能把Java注解讲的最清楚的一篇文章 · 10buns</title><meta name="description" content="可能把Java注解讲的最清楚的一篇文章 - 10buns"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://10buns.com/atom.xml" title="10buns"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.ico" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://www.weibo.com/loverichy" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/10Buns" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">可能把Java注解讲的最清楚的一篇文章</h1><div class="post-info">Jul 11, 2018</div><div class="post-content"><h3 id="什么是注解"><a href="#什么是注解" class="headerlink" title="什么是注解"></a>什么是注解</h3><blockquote>
<p>在 Java 中 Annotation是一个很重要的知识点 , 中文翻译过来就是注解 、批注的意思 。</p>
</blockquote>
<p>第一次学习注解的时候 , 看了很多文章解释一堆 , 但是感觉太抽象 ,  对初学者不是很友好 。</p>
<p>之前一直在思考怎么才能浅显易懂的介绍注解 ,  我就想啊想 。。。</p>
<p>。。。</p>
<p>终于想到了一个很好的东西来解释注解 ,  现在网上对讨厌的人会给贴一个傻逼 、五毛 、睿智 ,  对喜欢的会贴个帅哥、小姐姐之类的标签 。但不管贴什么标签 , 人还是那个人 。 只是由于贴了不同的标签 ,  导致大家对这个人的看法会不一样 。</p>
<p>到这里 ,  我们可以用比喻的手法来解释注解了 : </p>
<blockquote>
<p>如果把代码看成由一个个独立个体组成的群体 ,  那么注解就是给这些个体 ,  也就是方法 、类 、包等贴上一个标签 。 那么也可以直接说注解就是标签 。</p>
</blockquote>
<h3 id="怎么定义注解"><a href="#怎么定义注解" class="headerlink" title="怎么定义注解"></a>怎么定义注解</h3><blockquote>
<p>注解通过 @interface 关键字进行定义 。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public @interface SampleAnnotation &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如何使用注解"><a href="#如何使用注解" class="headerlink" title="如何使用注解"></a>如何使用注解</h3><p>定义好了一个注解， 那如何使用呢 ？ 创建一个方法或者类 ，然后在方法或者类定义的地方加上 @SampleAnnotation 就可以用 SampleAnnotation 注解这个类了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@SampleAnnotation</span><br><span class="line">public class Sample &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>目前我们只是使用了注解 ，但还不能正常的执行 。 若想让他正常的工作 ，我们还需要引入一个新的概念 元注解 。</p>
<h3 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h3><p>可以注解到注解上的注解就叫元注解 ，主要有 @Retention、@Inherited、@Target、@Documented、@Repeatable 5 种。</p>
<h4 id="Retention"><a href="#Retention" class="headerlink" title="@Retention"></a>@Retention</h4><p>Retention 的英文直译就是保留。其用到一个注解上，用于说明这个注解的的存活时间。</p>
<p>有如下取值： </p>
<ul>
<li>RetentionPolicy.SOURCE 只在源码阶段保留 ，在编译器进行编译时将被丢弃忽视 。 </li>
<li>RetentionPolicy.CLASS 只被保留到编译进行的时候 ，并不会被加载到 JVM 中 。 </li>
<li>RetentionPolicy.RUNTIME 可以保留到程序运行的时候 ，它会被加载进入到 JVM 中 ，所以在程序运行时可以获取到它们 。 </li>
</ul>
<blockquote>
<p>如果注解说是一个标签 ，@Retention 就可以看成是给标签盖了一个时间戳 。</p>
</blockquote>
<h4 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h4><p>@Inherited 并不是说注解本身可以继承 ，而是说如果一个父类被 @Inherited 注解过的注解进行注解的话 ，如果子类没有被任何注解应用的话 ，那么这个子类就继承了父类的注解 。 </p>
<blockquote>
<p>换而言之 ，王健林非常有钱被人贴了一个土豪的标签 ，那么他儿子王思聪还没出名时没人给贴标签 ， 但是自然也是个富二代土豪 。</p>
</blockquote>
<p>代码如下 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Inherited</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@interface InheritedSample&#123;&#125;</span><br><span class="line"></span><br><span class="line">@InheritedSample</span><br><span class="line">public class Parent&#123;&#125;</span><br><span class="line"></span><br><span class="line">public class Son extends Parent&#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Target"><a href="#Target" class="headerlink" title="@Target"></a>@Target</h4><p>@Target 限定了注解的使用场景 。</p>
<blockquote>
<p>如果注解时标签 ，那么 @Target 限定使用场景好比 ，不同的标签有不同的场景 ， 你就不能说一个美女是帅哥、长腿欧巴。</p>
</blockquote>
<p>有如下取值 :</p>
<ul>
<li>ElementType.ANNOTATION_TYPE 可以给一个注解进行注解</li>
<li>ElementType.CONSTRUCTOR 可以给构造方法进行注解</li>
<li>ElementType.FIELD 可以给属性进行注解</li>
<li>ElementType.LOCAL_VARIABLE 可以给局部变量进行注解</li>
<li>ElementType.METHOD 可以给方法进行注解</li>
<li>ElementType.PACKAGE 可以给一个包进行注解</li>
<li>ElementType.PARAMETER 可以给一个方法内的参数进行注解</li>
<li>ElementType.TYPE 可以给一个类型进行注解，比如类、接口、枚举</li>
</ul>
<h4 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a>@Documented</h4><p>作用是能够将注解中的元素包含到 JavaDoc 中去 。</p>
<h4 id="Repeatable"><a href="#Repeatable" class="headerlink" title="@Repeatable"></a>@Repeatable</h4><p>可重复的 ，是 JDK 1.8 才加入的新特性。</p>
<blockquote>
<p>什么场景下需要多次应用呢 ，比如我是一个程序员 ，同时我也是一个帅哥 、宅男 。</p>
</blockquote>
<p>代码如下 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@interface Men &#123;</span><br><span class="line">    Man[]  value();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Repeatable(Men.class)</span><br><span class="line">@interface Man&#123;</span><br><span class="line">    String role default &quot;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Man(role=&quot;Homebody&quot;)</span><br><span class="line">@Man(role=&quot;HandSome&quot;)</span><br><span class="line">@Man(role=&quot;Devloper&quot;)</span><br><span class="line">public class Baozi&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注解的属性"><a href="#注解的属性" class="headerlink" title="注解的属性"></a>注解的属性</h3><p>注解的属性也就是成员变量 。注解只有成员变量 ，没有方法 。注解的成员变量在注解的定义中以<code>无形参的方法</code>形式来声明 ，方法名定义了该成员变量的名字 ，返回值定义了该成员变量的类型。</p>
<blockquote>
<p>属性的类型必须是 8 种基本数据类型加上类 、接口 、注解及其数组 。 也可以设置默认值 ，但需用 default 关键值指定 。</p>
</blockquote>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">public @interface SampleAnnotation &#123;</span><br><span class="line"></span><br><span class="line">    int id() default 0 ;</span><br><span class="line"></span><br><span class="line">    String name() default &quot;&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@SampleAnnotation(id=0, name=&quot;测试注解&quot;)</span><br><span class="line">public class Sample &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注解是怎么工作的"><a href="#注解是怎么工作的" class="headerlink" title="注解是怎么工作的"></a>注解是怎么工作的</h3><p>前面用标签来比喻注解 ，介绍了注解的语法和应用。但是此时我们只是可以定义 、应用注解 ，下面来说一下注解是怎么生效工作的 。</p>
<p>这里绕不开反射。</p>
<p>注解是通过反射获得 ，有如下几个步骤 :</p>
<ol>
<li>通过 Class 对象的 <code>isAnnotationPresent()</code> 方法判断是否使用了注解。</li>
<li><p>再通过 <code>getAnnotation()</code> 或者是 <code>getAnnotations()</code> 方法来获取注解对象 。</p>
<blockquote>
<p>前一方法返回指定类型的注解 ，后一方法返回这个元素上的所有注解 。</p>
</blockquote>
</li>
<li>如果可以获取到注解 ，就可以调用注解的属性方法了 。</li>
</ol>
<p>同样的 ，也可以获取属性和方法上的注解 。</p>
<p>代码如下 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">@SampleAnnotation()</span><br><span class="line">public class Test &#123;</span><br><span class="line"></span><br><span class="line">    @Check(&quot;属性测试&quot;)</span><br><span class="line">    int a;</span><br><span class="line"></span><br><span class="line">    @Perform</span><br><span class="line">    public void printA()&#123;&#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        boolean hasAnnotation = Test.class.isAnnotationPresent(SampleAnnotation.class);</span><br><span class="line"></span><br><span class="line">        //获取类的注解  </span><br><span class="line">        if ( hasAnnotation ) &#123;</span><br><span class="line">            TestAnnotation testAnnotation = Test.class.getAnnotation(SampleAnnotation.class);</span><br><span class="line">            System.out.println(&quot;id:&quot; + testAnnotation.id());</span><br><span class="line">            System.out.println(&quot;name:&quot; + testAnnotation.name());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            //获取一个成员变量上的注解</span><br><span class="line">            Field a = Test.class.getDeclaredField(&quot;a&quot;);</span><br><span class="line">            //取消 Java 的权限控制检查</span><br><span class="line">            a.setAccessible(true);        </span><br><span class="line">            Check check = a.getAnnotation(Check.class);</span><br><span class="line">            if ( check != null ) &#123;</span><br><span class="line">                System.out.println(&quot;check value:&quot;+check.value());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 获取方法中的注解</span><br><span class="line">            Method testMethod = Test.class.getDeclaredMethod(&quot;printA&quot;);</span><br><span class="line">            if ( testMethod != null ) &#123;    </span><br><span class="line">                Annotation[] ans = testMethod.getAnnotations();</span><br><span class="line">                for( int i = 0;i &lt; ans.length;i++) &#123;</span><br><span class="line">                    System.out.println(&quot;method printA annotation:&quot;+ans[i].annotationType().getSimpleName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (SecurityException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>必须要注意的是 ，如果注解要在运行时被提取 ，那么 @Retention 必须设置 RetentionPolicy.RUNTIME </p>
</blockquote>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>讲了这么多 ，那注解到底有什么用呢 ？<br>在官方文档中 ，有如下说明 :</p>
<blockquote>
<p>注解主要针对的是编译器和其它工具软件(SoftWare tool) 。当开发者使用了Annotation 修饰了类 、方法 、Field 等成员之后 ，这些 Annotation 不会自己生效 ，必须由开发者提供相应的代码来提取并处理 Annotation 信息 。这些处理提取和处理 Annotation 的代码统称为 APT（Annotation Processing Tool) 。</p>
</blockquote>
<p>此时我们心里有数了 ， 注解是给 APT 或者编译器用的。</p>
<p>实际开发中 ，使用注解的场景太多了 。 例如 Spring Boot 中使用 java 配置其实就是各种注解的使用 ，JUnit 测试框架 ，Lombok 等。</p>
<h3 id="回顾"><a href="#回顾" class="headerlink" title="回顾"></a>回顾</h3><ul>
<li>我们用标签来解释了注解 。</li>
<li>讲了注解的基本语法 、元注解 、属性等 。</li>
<li>注解的工作原理需要借助 Java 的反射 。</li>
<li>注解主要针对的是编译器和其它工具软件 。</li>
</ul>
<blockquote>
<p>感谢阅读 ，您的关注是我持续创作的动力 !</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/18/SpringMVC请求处理流程/" class="prev">PREV</a><a href="/2018/07/02/文案排版规范/" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2019 <a href="http://10buns.com">10buns</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>